;; Kanata configuration
;; nikivi-inspired modifier layers — no traditional modifier chords
;;
;; Modifier keys (tap = letter, hold = modifier):
;;   e = primary modifier (Cmd on macOS, Ctrl on Windows)
;;   a = Ctrl (both platforms — terminal/vim shortcuts)
;;   q = primary modifier + Shift
;;   ; = Shift
;;   Caps Lock = Escape (tap), Ctrl (hold)
;;
;; Layer keys (tap = letter, hold = activate layer):
;;   z = Zellij navigation (hjkl panes, n new, p session, space command layer)
;;
;; Generated by chezmoi — platform: {{ .chezmoi.os }}

(defcfg
  process-unmapped-keys yes
)

(defvar
  tt 300  ;; tap timeout (ms) — time before hold activates
  ht 250  ;; hold timeout (ms)
)

;; Only intercept the keys we remap — everything else passes through
(defsrc
  caps e a q ; z h j k l n p = - spc
)
(deflayer base
  @cap @emod @amod @qmod @semi @zmod _ _ _ _ _ _ _ _ _
)

(defalias
  ;; Caps Lock: tap = Escape, hold = Ctrl
  ;; Useful for vim escape and terminal Ctrl shortcuts
  cap (tap-hold-release $tt $ht esc lctl)

{{ if eq .chezmoi.os "darwin" }}
  ;; macOS: primary modifier = Cmd (lmet)
  emod (tap-hold-release $tt $ht e lmet)
  qmod (tap-hold-release $tt $ht q (multi lmet lsft))
{{ else }}
  ;; Windows/Linux: primary modifier = Ctrl (lctl)
  emod (tap-hold-release $tt $ht e lctl)
  qmod (tap-hold-release $tt $ht q (multi lctl lsft))
{{ end }}

  ;; a: tap = a, hold = Ctrl (both platforms)
  ;; For terminal shortcuts: Ctrl+C (interrupt), Ctrl+A, Ctrl+R, etc.
  amod (tap-hold-release $tt $ht a lctl)

  ;; ;: tap = ;, hold = Shift
  ;; Hold ; and press any letter for uppercase, or ; + number for symbols
  semi (tap-hold-release $tt $ht ; lsft)
  ;; z: tap = z, hold = activate Zellij layer
  zmod (tap-hold-release $tt $ht z (layer-toggle zellij))
)

;; ── z-mode: Zellij navigation ─────────────────────────────
;; Hold z, press key → Zellij shortcut (no Alt/Ctrl stretching)
(deflayer zellij
  _    _    _    _    _    _
  A-h  A-j  A-k  A-l         ;; hjkl → Alt+hjkl (pane nav)
  A-n                         ;; n → Alt+n (new pane)
  A-p                         ;; p → Alt+p (session manager)
  A-=  A--                    ;; =/- → Alt+=/- (resize)
  C-g                         ;; space → Ctrl+g (command layer)
)