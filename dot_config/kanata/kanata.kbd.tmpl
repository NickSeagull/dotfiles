;; Kanata configuration
;; nikivi-inspired modifier layers — no traditional modifier chords
;;
;; Layer keys (tap = letter, hold = modifier):
;;   e = primary modifier (Cmd on macOS, Ctrl on Windows)
;;   a = Ctrl (both platforms — terminal/vim shortcuts)
;;   q = primary modifier + Shift
;;   ; = Shift
;;   Caps Lock = Escape (tap), Ctrl (hold)
;;
;; Generated by chezmoi — platform: {{ .chezmoi.os }}

(defcfg
  process-unmapped-keys yes
)

(defvar
  tt 300  ;; tap timeout (ms) — time before hold activates
  ht 250  ;; hold timeout (ms)
)

;; Only intercept the keys we remap — everything else passes through
(defsrc
  caps e a q ;
)

(deflayer base
  @cap @emod @amod @qmod @semi
)

(defalias
  ;; Caps Lock: tap = Escape, hold = Ctrl
  ;; Useful for vim escape and terminal Ctrl shortcuts
  cap (tap-hold-release $tt $ht esc lctl)

{{ if eq .chezmoi.os "darwin" }}
  ;; macOS: primary modifier = Cmd (lmet)
  emod (tap-hold-release $tt $ht e lmet)
  qmod (tap-hold-release $tt $ht q (multi lmet lsft))
{{ else }}
  ;; Windows/Linux: primary modifier = Ctrl (lctl)
  emod (tap-hold-release $tt $ht e lctl)
  qmod (tap-hold-release $tt $ht q (multi lctl lsft))
{{ end }}

  ;; a: tap = a, hold = Ctrl (both platforms)
  ;; For terminal shortcuts: Ctrl+C (interrupt), Ctrl+A, Ctrl+R, etc.
  amod (tap-hold-release $tt $ht a lctl)

  ;; ;: tap = ;, hold = Shift
  ;; Hold ; and press any letter for uppercase, or ; + number for symbols
  semi (tap-hold-release $tt $ht ; lsft)
)